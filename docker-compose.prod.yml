version: '3.8'

services:
  watchtower:
    image: python:3.11-slim
    # SECURITY: Drop all capabilities. The dashboard cannot change system state.
    cap_drop:
      - ALL
    # SECURITY: Run as non-root user
    user: 1000:1000
    # SECURITY: Read-Only filesystem (Glass, not Gears)
    read_only: true
    volumes:
      # Mount agents as READ-ONLY (:ro) to prove it cannot mutate the ledger
      - ./agents:/app/agents:ro
      # Tmp for streamlint internals only
      - ./tmp:/tmp
    command: ["streamlit", "run", "dashboard.py"]
    networks:
      - helix-net
    # SECURITY: No egress allowed (Internal dashboard only)
    # (Requires firewall rules, but intent is declared here)

  # Enforcer runs on METAL (Outside Docker in Prod), or in a signed SGX enclave.
  # It is removed from this compose file to enforce the separation.

networks:
  helix-net:
    driver: bridge
    internal: true # No internet access
