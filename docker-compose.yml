version: '3.8'

services:
  watchtower:
    # Python 3.11-slim (Pinned Digest)
    image: python@sha256:2f039322312674e20967650942d99d3d3b76920f2693950ba3cb8be23c220275
    container_name: helix_watchtower
    restart: unless-stopped
    cap_drop: [ALL]
    user: 1000:1000
    read_only: true
    networks:
      - helix-net
    ports:
      - "127.0.0.1:8501:8501"
    volumes:
      - ./identity:/app:ro
      - ./agents:/app/agents:ro
      - type: tmpfs
        target: /tmp
    command: sh -c "pip install --no-cache-dir . && streamlit run dashboard.py"

  hgl-compiler:
    image: python@sha256:2f039322312674e20967650942d99d3d3b76920f2693950ba3cb8be23c220275
    container_name: helix_hgl
    cap_drop: [ALL]
    user: 1000:1000
    read_only: true
    networks:
      - helix-net
    volumes:
      - ./hgl:/app:ro
    command: python3 cli/hglc/hglc.py --help

networks:
  helix-net:
    driver: bridge
    internal: true
